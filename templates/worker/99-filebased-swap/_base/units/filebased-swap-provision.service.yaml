{{- if .EnableFileBasedSwap }}
name: filbased-swap-provision-{{ .Index }}.service
enabled: true
contents: |
  [Unit]
  Description=Provision and enable swap
  ConditionFirstBoot=no
  ConditionPathExists=!{{ .SwapFilePath }}
  
  [Service]
  Type=oneshot
  Environment=SWAP_SIZE={{ .SwapFileSize }}
  ExecStart=/bin/sh -c "sudo fallocate -l ${SWAP_SIZE} {{ .SwapFilePath }} && \
  sudo chmod 600 {{ .SwapFilePath }} && \
  sudo mkswap {{ .SwapFilePath }} && \
  sudo swapon {{ .SwapFilePath }}"
  
  [Install]
  RequiredBy=kubelet-dependencies.target
{{- end}}
